import{timeParse as e,timeFormat as t}from"d3-time-format";const n=/,|%|[$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]/g;async function r(e){let t={rows:[],cols:[]};var n;t.head=Object.keys(e[0]),t.rows=function(e){if(!e||!Array.isArray(e)||0===e.length)return[];const t=Object.keys(e[0]),n=e.map((e=>t.map((t=>e[t]))));return n.unshift(t),n}(e),t.cols=(n=t.rows)[0].map(((e,t)=>n.map((e=>e[t])))),t.body=t.rows.slice(1);const{cols:r,rows:a}=t;let c={};return c.type=await s(r),u({...t,...c})}const s=async e=>e.map(((e,t)=>{let n=a(e.slice(1),"body").types;t>0&&(n=n.filter((e=>"date"!==e)));let r=[];return n.forEach((t=>{let n={status:!1};"number"===t&&(n=i(e.slice(1))),"string"===t&&(n=v(e.slice(1))),"date"===t&&(n=d(e.slice(1))),r.push({type:t,format:{...n}})})),{list:n,format:r}}));function u(e){const{head:t,type:n,rows:r,body:s}=e;return t.map(((e,t)=>({column:e,index:t,label:e,dataTypes:n[t].list,formats:n[t].format})))}function a(e="",t){let n={types:[]},r="body"===t?e.filter((e=>e)):e;const s=function(e){const t=y(e)||p(e)||m(e,l)||h(e)||g(e);return{valid:!!t}}(r);s.valid&&n.types.push("date");const u=c(r);if(u.valid&&n.types.push("number"),!u.format&&"number"!==n.types.join()){(a=r,a.filter(((e,t)=>t===a.indexOf(e)))).length;r.length,n.types.push("string")}var a;return n.types.sort(),n}function c(e){let t=e.map((e=>("string"==typeof e&&(e=e.replace(n,"")),""===e?NaN:e))).filter((e=>!isNaN(e))).map((e=>parseFloat(e)));return{valid:t.length===e.filter((e=>""!==e)).length,values:t}}function o(e){if(e.length<2)return!0;e.sort(((e,t)=>e-t));const t=e[1]-e[0];for(let n=2;n<e.length;n++)if(e[n]-e[n-1]!==t)return!1;return!0}function i(e){let t=c(e).values;return{min:Math.min(...t),max:Math.max(...t),scale:M(t),hasEmptyValues:t.length!=e.length,sequential:o(t)}}const l=["%d-%b-%y","%d %b %Y","%d %b","%d-%B-%y","%d %B %Y","%d %B","%Y-%m-%d","%Y-%m-%dT%H:%M:%S%Z","%m/%d/%y %H:%M","%m/%d/%y %I:%M %p","%H:%M:%S","%b-%y","%b %y","%Y %b","%b %Y","%B-%y","%B %y","%Y %B","%B %Y","%Y-%y","%Y/%y","%b","%B"],f=["%m/%d/%y","%m/%d/%Y"];function d(e){const t=y(e)||p(e)||m(e,l)||h(e)||g(e),n=t.includes("%d")||t.includes("%H");return{dateFormat:t,hasDay:n,scale:M(e)}}function m(t,n){let r,s=n.find((n=>(r=e(n),r(t[0]))));return s&&t.every((e=>r(e)))?s:""}function y(e){let t=m(e,f);if(t){const n=e.every((e=>e.split("/")[0]<=12)),r=e.some((e=>e.split("/")[1]>12));t=n&&r?t:"%d/%m/"+t.slice(-2),n&&!r&&console.warn("Format unclear!!!")}return t||""}function p(e){const t="%Y",n=m(e,[t])===t,r=e.every((e=>4===e.length));return n&&r?t:""}function h(e){const t=e.every((e=>("Q"===e[0]||"Q"===e[5])&&7===e.length)),n="%Y"===m(e.map((e=>e.replace(/Q([1-4])/g,"").trim())),["%Y"]);return t&&n?"Q*":""}function g(e){const t="%Y%m%d",n=m(e,[t])===t,r=e.every((e=>{const t=e.slice(4,6);return t>=1&&t<=12})),s=e.every((e=>{const t=e.slice(6);return t>=1&&t<=31}));return n&&r&&s?t:""}function b(t,n,r,s=!1){let u;const a=e=>t.map((t=>e(t)));switch(!0){case["%Y"].includes(n):return t.map((e=>+e));case["Q*"].includes(n):{const e=t[0].indexOf("Q");return t.map((t=>+t.replace(/Q([1-4])/g,"").trim()+.25*(+t[e+1]-1)))}case["%Y-%y","%Y/%y"].includes(n):return t.map((e=>+e.slice(0,4)));case["%b","%B"].includes(n):return u=e(s?"%b":n),a(u).map((e=>e.getMonth()));case!r:return u=e(s?"%b %Y":n),a(u).map((e=>e.getFullYear()+e.getMonth()/12));default:return u=e(n),a(u)}}function Y(e,n,r){const s=e.toString().split(".")[0],u=e%1;let a,c,o;switch(!0){case["%Y"].includes(n):return e.toString();case["Q*"].includes(n):return"Q"+(e%1*4+1)+" "+s;case["%Y-%y","%Y/%y"].includes(n):return e+"-"+(e+1).toString().slice(-2);case["%b","%B"].includes(n):return a=new Date(2017,e),o=t("%b"),o(a);case!r:return c=Math.round(parseFloat(12*u)),a=new Date(s,c||0),o=t("%b %Y"),o(a);default:return null}}function F(e){const t=e[1].getFullYear()-e[0].getFullYear(),n=e[1].getMonth()-e[0].getMonth(),r=e[1].getDate()-e[0].getDate(),s=e[1].getHours()-e[0].getHours();switch(!0){case t>4:return"%Y";case t>0:return"%b %Y";case n>4:return"%b";case n>0:return"%d %b";case r>0:return"%d %I%p";case s>0:return"%H:%M";default:return console.error("A new time format is required!"),""}}function v(e){return{hasRepeat:B(e),longest:w(e),scale:M(e)}}function w(e){if(0===e.length)return 0;let t=0;for(const n of e)n.length>t&&(t=n.length);return t}function B(e){const t=new Set;for(const n of e){if(t.has(n))return!0;t.add(n)}return!1}function M(e){if(!Array.isArray(e)||0===e.length)return"Invalid data";const t=e[0],n=e.every((e=>"number"==typeof e)),r=e.every((e=>e instanceof Date)),s=e.some((e=>e<0)),u=new Set(e).size;if(r)return"scaleTime";if(n){if(s)return"scaleLinear";return Math.max(...e)/Math.min(...e)>1e3?"scaleLog":"scaleLinear"}return"string"!=typeof t&&n?"Unknown scale type":u===e.length?"scaleOrdinal":"scaleBand"}function x(e,t){if(e.length!==t.length)return e;const n=e.map((e=>e.column));if(!t.every((e=>n.includes(e))))return e;const r=t.map((t=>e.find((e=>e.column===t))));return r.forEach(((e,t)=>{e.index=t})),r.sort(((e,t)=>e.index-t.index)),r}export{Y as dateNumToTxt,M as determineD3ScaleType,a as getDataTypeAnalysis,d as getDateFormatting,b as getDateScaleValues,F as getDateTextFormat,i as getNumberFormatting,v as getStringFormatting,u as processJsonData,r as schema,x as sortJsonByColumnOrder};
